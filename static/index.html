<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VTSearch</title>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/static/styles.css">
</head>
<body>
<header>
  <nav class="burger-menu" aria-label="Main menu">
    <button class="burger-btn" id="burger-btn" aria-label="Menu" aria-expanded="false" aria-haspopup="true">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </button>
    <div class="burger-dropdown" id="burger-dropdown" role="menu" aria-label="Main menu">
      <div class="burger-section" role="group" aria-label="Dataset">
        <div class="burger-section-title" id="menu-section-dataset">Dataset</div>
        <div class="burger-item" id="menu-dataset-change" role="menuitem" tabindex="-1">Change Dataset</div>
        <div class="burger-item" id="menu-dataset-export" role="menuitem" tabindex="-1">Export Dataset</div>
      </div>
      <div class="burger-section" role="group" aria-label="Labels">
        <div class="burger-section-title" id="menu-section-labels">Labels</div>
        <div class="burger-item" id="menu-labels-import" role="menuitem" tabindex="-1">Import Labels</div>
        <div class="burger-item" id="menu-labels-export" role="menuitem" tabindex="-1">Export Labels</div>
        <div class="burger-status" id="menu-labels-status" aria-live="polite"></div>
      </div>
      <div class="burger-section" role="group" aria-label="Detector">
        <div class="burger-section-title" id="menu-section-detector">Detector</div>
        <div class="burger-item" id="menu-detector-import" role="menuitem" tabindex="-1">Load Sort</div>
        <div class="burger-item" id="menu-detector-export" role="menuitem" tabindex="-1">Export Detector</div>
        <div class="burger-status" id="menu-detector-status" aria-live="polite"></div>
      </div>
      <div class="burger-section" role="group" aria-label="Favorite Detectors">
        <div class="burger-section-title" id="menu-section-favorites">Favorite Detectors</div>
        <div class="burger-item" id="menu-favorites-manage" role="menuitem" tabindex="-1">Manage Favorites</div>
        <div class="burger-item" id="menu-favorites-import" role="menuitem" tabindex="-1">Import Detector</div>
        <div class="burger-item" id="menu-favorites-autodetect" role="menuitem" tabindex="-1">Run Auto-Detect</div>
        <div class="burger-status" id="menu-favorites-status" aria-live="polite"></div>
      </div>
      <div class="burger-section">
        <div class="burger-section-title">Appearance</div>
        <div class="theme-toggle">
          <span class="theme-toggle-label" id="theme-label">Light Mode</span>
          <label class="theme-switch">
            <input type="checkbox" id="theme-toggle-checkbox">
            <span class="theme-switch-slider"></span>
          </label>
        </div>
      </div>
      <div class="burger-section">
        <div class="burger-section-title">Calibration</div>
        <div style="display:flex; align-items:center; gap:6px">
          <label for="calibrate-count-input" style="font-size:0.78rem; color:var(--text-secondary); cursor:pointer; white-space:nowrap">Calibrate Count</label>
          <input type="number" id="calibrate-count-input" min="1" max="100" value="2" step="1" style="width:56px; padding:4px 6px; border:1px solid var(--border); border-radius:4px; background:var(--bg-surface); color:var(--text-primary); font-size:0.85rem; text-align:center; outline:none">
        </div>
      </div>
    </div>
  </nav>
  <h1>VTSearch</h1>
  <img src="/static/logo.png" alt="VTSearch logo" class="header-logo">
</header>
<div class="layout" role="presentation">
  <!-- Left panel -->
  <div class="panel-left" id="left-panel" role="region" aria-label="Clip list">
    <div class="dataset-bar" id="dataset-bar" style="display:none">
      <span class="dataset-info" id="dataset-info">No dataset loaded</span>
    </div>
    <h2>Clips</h2>
    <div class="sort-bar" id="sort-bar">
      <span class="sort-label">Sort</span>
      <div class="sort-mode">
        <label><input type="radio" name="sort-mode" value="text" checked> Text</label>
        <label><input type="radio" name="sort-mode" value="learned" id="learned-radio"> Learn</label>
        <label><input type="radio" name="sort-mode" value="load" id="load-radio"> Load</label>
      </div>
      <div id="text-sort-wrap">
        <label for="text-sort" class="sr-only">Text sort query</label>
        <input type="text" id="text-sort" placeholder='e.g. "high pitched beep"'>
      </div>
      <div id="load-sort-wrap" style="display:none">
        <button id="load-detector-btn" style="width:100%; padding:6px; background:var(--accent); color:#fff; border:none; border-radius:4px; cursor:pointer; font-size:0.85rem;">Load Detector</button>
        <input type="file" id="load-detector-file" accept=".json" style="display:none" aria-label="Detector file">
      </div>
      <span class="sort-label" style="margin-top:8px">Select</span>
      <div class="sort-mode">
        <label><input type="radio" name="select-mode" value="top" checked> Top</label>
        <label><input type="radio" name="select-mode" value="hard"> Hard</label>
      </div>
      <span class="sort-label" style="margin-top:8px">Inclusion</span>
      <div style="display:flex; align-items:center; gap:8px; margin-top:4px">
        <span style="font-size:0.7rem; color:var(--text-muted)">-10</span>
        <label for="inclusion-slider" class="sr-only">Inclusion</label>
        <input type="range" id="inclusion-slider" min="-10" max="10" value="0" step="1" aria-valuetext="0" style="flex:1; accent-color:var(--accent)">
        <span style="font-size:0.7rem; color:var(--text-muted)">+10</span>
      </div>
      <div style="text-align:center; font-size:0.75rem; color:var(--text-secondary); margin-top:2px">
        <span id="inclusion-value">0</span>
      </div>
      <div style="display:flex; align-items:center; gap:6px; margin-top:8px">
        <input type="checkbox" id="enrich-descriptions-checkbox" style="accent-color:var(--accent)">
        <label for="enrich-descriptions-checkbox" style="font-size:0.78rem; color:var(--text-secondary); cursor:pointer">Enrich Sort Descriptions</label>
      </div>
      <div id="sort-status" class="sort-status" aria-live="polite"></div>
      <div id="sort-progress" class="sort-progress" role="status" aria-live="polite">
        <div class="sort-progress-bar">
          <div class="sort-progress-fill"></div>
        </div>
        <div class="sort-progress-label" id="sort-progress-label">Searching and sorting...</div>
      </div>
    </div>
    <div id="clip-list" role="listbox" aria-label="Clips"></div>
    <div class="stripe-overview" id="stripe-overview" role="img" aria-label="Clip overview showing labeled clips and current position">
      <div class="stripe-container" id="stripe-container" aria-hidden="true"></div>
    </div>
  </div>

  <!-- Center panel -->
  <main class="panel-center" id="center">
    <div class="dataset-welcome" id="dataset-welcome">
      <div>
        <h2>Welcome to VTSearch</h2>
        <p>Load or generate a dataset to get started</p>
      </div>
      <div class="dataset-options" id="dataset-options">
        <button class="dataset-option" id="load-file-btn">
          <h3>üìÅ Load from File</h3>
          <p>Load a previously saved dataset file (.pkl)</p>
        </button>
      </div>
      <div class="dataset-progress" id="dataset-progress" style="display:none" role="status" aria-live="polite">
        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Dataset loading progress">
          <div class="progress-fill" id="progress-fill" style="width:0%"></div>
          <div class="progress-text" id="progress-text" aria-hidden="true">0%</div>
        </div>
        <div class="progress-message" id="progress-message">Loading...</div>
        <div class="progress-eta" id="progress-eta"></div>
      </div>
      <div class="demo-datasets" id="demo-datasets" style="display:none"></div>
      <div id="extended-importer-form" style="display:none"></div>
      <button class="back-button" id="back-button" style="display:none" aria-label="Back to dataset options">Back</button>
    </div>
  </main>
  <input type="file" id="file-input" accept=".pkl" style="display:none" aria-label="Dataset file">

  <!-- Right panel -->
  <aside class="panel-right" aria-label="Labels">
    <!-- import-file removed: label import now uses the label importer modal -->
    <div class="progress-check-bar">
      <button id="check-progress-btn" class="labeling-indicator" data-status="" aria-label="Check labeling progress">
        <span class="indicator-dot" aria-hidden="true"></span>
        <span class="indicator-label">Progress</span>
        <span class="indicator-subtext" id="indicator-subtext"></span>
      </button>
    </div>
    <div class="label-sort-bar">
      <span class="sort-label" style="font-size:0.72rem; color:var(--text-dim);">Sort labels</span>
      <label for="label-sort-select" class="sr-only">Sort labels</label>
      <select id="label-sort-select" style="padding:3px 6px; font-size:0.78rem; background:var(--bg-surface); color:var(--text-primary); border:1px solid var(--border); border-radius:4px;">
        <option value="time-desc">Newest first</option>
        <option value="time-asc">Oldest first</option>
        <option value="name-asc">Name A‚ÄìZ</option>
        <option value="name-desc">Name Z‚ÄìA</option>
        <option value="confidence-desc">Confidence ‚Üì</option>
        <option value="confidence-asc">Confidence ‚Üë</option>
        <option value="id-asc">ID ‚Üë</option>
      </select>
    </div>
    <div class="vote-section">
      <h3 class="good">Good <span class="label-count" id="good-count">(0)</span></h3>
      <div id="good-list"></div>
    </div>
    <div class="vote-section">
      <h3 class="bad">Bad <span class="label-count" id="bad-count">(0)</span></h3>
      <div id="bad-list"></div>
    </div>
  </aside>
</div>

<!-- Progress Modal -->
<div id="progress-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="progress-modal-title">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="progress-modal-title">Labeling Progress Analysis</h2>
      <button class="modal-close" id="modal-close" aria-label="Close">&times;</button>
    </div>
    <div class="modal-body">
      <div class="progress-summary">
        <div class="progress-stat">
          <div class="progress-stat-label">Total Labels</div>
          <div class="progress-stat-value" id="stat-total-labels">0</div>
        </div>
        <div class="progress-stat">
          <div class="progress-stat-label">Total Clips</div>
          <div class="progress-stat-value" id="stat-total-clips">0</div>
        </div>
      </div>
      <div class="progress-chart">
        <h3>Error Cost Over Time</h3>
        <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 8px;">
          Lower is better. When the line levels out, you're probably not making progress.
        </p>
        <canvas id="error-cost-chart" width="700" height="250"></canvas>
      </div>
      <div class="progress-chart">
        <h3>Prediction Stability</h3>
        <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 8px;">
          Shows how many unlabeled clips change prediction at each step. When this stabilizes near zero, you're probably not making progress.
        </p>
        <canvas id="stability-chart" width="700" height="250"></canvas>
      </div>
      <div class="progress-recommendation">
        <h3>Recommendation</h3>
        <p id="recommendation-text">Loading...</p>
      </div>
    </div>
  </div>
</div>

<!-- Favorite Detectors Management Modal -->
<div id="favorites-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="favorites-modal-title">
  <div class="modal-content" style="max-width: 700px;">
    <div class="modal-header">
      <h2 id="favorites-modal-title">Manage Favorite Detectors</h2>
      <button class="modal-close" id="favorites-modal-close" aria-label="Close">&times;</button>
    </div>
    <div class="modal-body">
      <!-- Add Detector Section -->
      <div style="background: var(--bg-panel); border: 1px solid var(--border); border-radius: 6px; padding: 16px; margin-bottom: 20px;">
        <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-dim); margin-bottom: 10px;">Add Detector</div>
        <div style="margin-bottom: 10px;">
          <label style="font-size: 0.78rem; color: var(--text-muted); display: block; margin-bottom: 4px;">Name (optional ‚Äî defaults to filename)</label>
          <input type="text" id="fav-add-name" placeholder="e.g. Dog Barks" style="width: 100%; padding: 6px 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-surface); color: var(--text-primary); font-size: 0.85rem; outline: none;">
        </div>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          <button id="fav-add-from-votes-btn" style="flex: 1; padding: 8px 12px; background: var(--accent); color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">From Current Labels</button>
        </div>
        <div id="fav-importer-buttons" style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px;"></div>
        <div id="fav-add-status" style="font-size: 0.78rem; color: var(--text-muted); margin-top: 8px; min-height: 1.2em;"></div>
      </div>
      <!-- Saved Detectors List -->
      <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-dim); margin-bottom: 8px;">Saved Detectors</div>
      <div id="favorites-list">
        <p style="color: var(--text-muted);">No favorite detectors saved yet.</p>
      </div>
    </div>
  </div>
</div>
<!-- Hidden file inputs for favorites modal (created dynamically by app.js) -->

<!-- Auto-Detect Results Modal -->
<div id="autodetect-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="autodetect-modal-title">
  <div class="modal-content" style="max-width: 1000px;">
    <div class="modal-header">
      <h2 id="autodetect-modal-title">Auto-Detect Results</h2>
      <button class="modal-close" id="autodetect-modal-close" aria-label="Close">&times;</button>
    </div>
    <div class="modal-body">
      <div id="autodetect-summary" style="margin-bottom: 16px;"></div>
      <div id="autodetect-results" style="max-height: 500px; overflow-y: auto;"></div>
      <div style="margin-top: 16px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
        <label style="color: var(--text-secondary); font-size: 0.85rem;">Column:
          <select id="copy-column-select" style="padding: 4px 8px; background: var(--bg-surface); color: var(--text-primary); border: 1px solid var(--border); border-radius: 4px; font-size: 0.85rem; margin-left: 4px;">
            <option value="origin+name">origin+name</option>
            <option value="name">name</option>
            <option value="md5">md5</option>
            <option value="filename">filename</option>
            <option value="origin">origin</option>
          </select>
        </label>
        <label style="color: var(--text-secondary); font-size: 0.85rem;">Separator:
          <select id="copy-separator-select" style="padding: 4px 8px; background: var(--bg-surface); color: var(--text-primary); border: 1px solid var(--border); border-radius: 4px; font-size: 0.85rem; margin-left: 4px;">
            <option value="newline">newline</option>
            <option value=",">,</option>
            <option value="tab">tab</option>
            <option value="space">space</option>
          </select>
        </label>
        <button id="copy-results-btn" style="padding: 8px 16px; background: var(--accent); color: #fff; border: none; border-radius: 4px; cursor: pointer;">Copy To Clipboard</button>
      </div>
    </div>
  </div>
</div>

<!-- Auto-Detect Progress Modal -->
<div id="autodetect-progress-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="autodetect-progress-title">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="autodetect-progress-title">Running Auto-Detect</h2>
    </div>
    <div class="modal-body">
      <div id="autodetect-progress-text" style="margin-bottom: 16px; color: var(--text-primary);" aria-live="polite">Initializing...</div>
      <div style="background: var(--border); border-radius: 8px; overflow: hidden; height: 24px;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Auto-detect progress">
        <div id="autodetect-progress-bar" style="background: var(--accent); height: 100%; width: 0%; transition: width 0.3s;"></div>
      </div>
    </div>
  </div>
</div>

<!-- Label Importer Picker Modal -->
<div id="label-importer-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="label-importer-modal-title">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <h2 id="label-importer-modal-title">Import Labels</h2>
      <button class="modal-close" id="label-importer-modal-close" aria-label="Close">&times;</button>
    </div>
    <div class="modal-body">
      <div id="label-importer-list"></div>
      <div id="label-importer-form" style="display:none"></div>
      <button id="label-importer-back" aria-label="Back to importer list" style="display:none; margin-top:12px; padding:6px 14px; background:var(--bg-secondary-btn); color:var(--text-btn-secondary); border:1px solid var(--border-secondary); border-radius:4px; cursor:pointer;">&#8592; Back</button>
    </div>
  </div>
</div>

<!-- Processor Importer Picker Modal -->
<div id="processor-importer-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="processor-importer-modal-title">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <h2 id="processor-importer-modal-title">Import Detector</h2>
      <button class="modal-close" id="processor-importer-modal-close" aria-label="Close">&times;</button>
    </div>
    <div class="modal-body">
      <div id="processor-importer-list"></div>
      <div id="processor-importer-form" style="display:none"></div>
      <button id="processor-importer-back" aria-label="Back to importer list" style="display:none; margin-top:12px; padding:6px 14px; background:var(--bg-secondary-btn); color:var(--text-btn-secondary); border:1px solid var(--border-secondary); border-radius:4px; cursor:pointer;">&#8592; Back</button>
    </div>
  </div>
</div>

<!-- Custom VTSearch Dialog (replaces native alert/confirm/prompt) -->
<div id="vt-dialog-modal" class="modal" role="alertdialog" aria-modal="true" aria-labelledby="vt-dialog-message">
  <div class="modal-content vt-dialog-box">
    <div class="vt-dialog-header">
      <span class="vt-dialog-icon" id="vt-dialog-icon"></span>
      <h2>VTSearch</h2>
    </div>
    <div class="vt-dialog-body">
      <p id="vt-dialog-message"></p>
      <input type="text" id="vt-dialog-input" class="vt-dialog-input" style="display:none">
    </div>
    <div class="vt-dialog-actions" id="vt-dialog-actions"></div>
  </div>
</div>

<!-- Labeling Progress Analysis Loading Modal -->
<div id="labeling-analysis-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="labeling-analysis-title">
  <div class="modal-content" style="min-width: 360px;">
    <div class="modal-header">
      <h2 id="labeling-analysis-title">Analyzing Labeling Progress</h2>
    </div>
    <div class="modal-body">
      <div id="labeling-analysis-text" style="margin-bottom: 16px; color: var(--text-secondary); font-size: 0.9rem;" aria-live="polite">Training models over label history‚Ä¶</div>
      <div style="background: var(--border); border-radius: 8px; overflow: hidden; height: 24px; position: relative;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Analysis progress">
        <div id="labeling-analysis-bar" style="background: linear-gradient(90deg, var(--accent), var(--accent-light)); height: 100%; width: 0%; transition: width 0.3s;"></div>
        <div id="labeling-analysis-pct" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 0.75rem; color: #fff; font-weight: bold;" aria-hidden="true">0%</div>
      </div>
    </div>
  </div>
</div>

<script src="/static/app.js"></script>
</body>
</html>
