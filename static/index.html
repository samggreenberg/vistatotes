<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VTSearch</title>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/static/styles.css">
</head>
<body>
<header>
  <div class="burger-menu">
    <button class="burger-btn" id="burger-btn">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <div class="burger-dropdown" id="burger-dropdown">
      <div class="burger-section">
        <div class="burger-section-title">Dataset</div>
        <div class="burger-item" id="menu-dataset-change">Change Dataset</div>
        <div class="burger-item" id="menu-dataset-export">Export Dataset</div>
      </div>
      <div class="burger-section">
        <div class="burger-section-title">Labels</div>
        <div class="burger-item" id="menu-labels-import">Import Labels</div>
        <div class="burger-item" id="menu-labels-export">Export Labels</div>
        <div class="burger-status" id="menu-labels-status"></div>
      </div>
      <div class="burger-section">
        <div class="burger-section-title">Detector</div>
        <div class="burger-item" id="menu-detector-import">Load Sort</div>
        <div class="burger-item" id="menu-detector-export">Export Detector</div>
        <div class="burger-status" id="menu-detector-status"></div>
      </div>
      <div class="burger-section">
        <div class="burger-section-title">Favorite Detectors</div>
        <div class="burger-item" id="menu-favorites-manage">Manage Favorites</div>
        <div class="burger-item" id="menu-favorites-import">Import Detector</div>
        <div class="burger-item" id="menu-favorites-autodetect">Run Auto-Detect</div>
        <div class="burger-status" id="menu-favorites-status"></div>
      </div>
    </div>
  </div>
  <h1>VTSearch</h1>
  <img src="/static/logo.png" alt="VTSearch logo" class="header-logo">
</header>
<div class="layout">
  <!-- Left panel -->
  <div class="panel-left" id="left-panel">
    <div class="dataset-bar" id="dataset-bar" style="display:none">
      <span class="dataset-info" id="dataset-info">No dataset loaded</span>
    </div>
    <h2>Clips</h2>
    <div class="sort-bar" id="sort-bar">
      <span class="sort-label">Sort</span>
      <div class="sort-mode">
        <label><input type="radio" name="sort-mode" value="text" checked> Text</label>
        <label><input type="radio" name="sort-mode" value="learned" id="learned-radio"> Learn</label>
        <label><input type="radio" name="sort-mode" value="load" id="load-radio"> Load</label>
      </div>
      <div id="text-sort-wrap">
        <input type="text" id="text-sort" placeholder='e.g. "high pitched beep"'>
      </div>
      <div id="load-sort-wrap" style="display:none">
        <button id="load-detector-btn" style="width:100%; padding:6px; background:#7c8aff; color:#fff; border:none; border-radius:4px; cursor:pointer; font-size:0.85rem;">Load Detector</button>
        <input type="file" id="load-detector-file" accept=".json" style="display:none">
      </div>
      <span class="sort-label" style="margin-top:8px">Select</span>
      <div class="sort-mode">
        <label><input type="radio" name="select-mode" value="top" checked> Top</label>
        <label><input type="radio" name="select-mode" value="hard"> Hard</label>
      </div>
      <span class="sort-label" style="margin-top:8px">Inclusion</span>
      <div style="display:flex; align-items:center; gap:8px; margin-top:4px">
        <span style="font-size:0.7rem; color:#888">-10</span>
        <input type="range" id="inclusion-slider" min="-10" max="10" value="0" step="1" style="flex:1; accent-color:#7c8aff">
        <span style="font-size:0.7rem; color:#888">+10</span>
      </div>
      <div style="text-align:center; font-size:0.75rem; color:#aaa; margin-top:2px">
        <span id="inclusion-value">0</span>
      </div>
      <div id="sort-status" class="sort-status"></div>
      <div id="sort-progress" class="sort-progress">
        <div class="sort-progress-bar">
          <div class="sort-progress-fill"></div>
        </div>
        <div class="sort-progress-label" id="sort-progress-label">Searching and sorting...</div>
      </div>
    </div>
    <div id="clip-list"></div>
    <div class="stripe-overview" id="stripe-overview">
      <div class="stripe-container" id="stripe-container"></div>
    </div>
  </div>

  <!-- Center panel -->
  <div class="panel-center" id="center">
    <div class="dataset-welcome" id="dataset-welcome">
      <div>
        <h2>Welcome to VTSearch</h2>
        <p>Load or generate a dataset to get started</p>
      </div>
      <div class="dataset-options" id="dataset-options">
        <button class="dataset-option" id="load-file-btn">
          <h3>üìÅ Load from File</h3>
          <p>Load a previously saved dataset file (.pkl)</p>
        </button>
      </div>
      <div class="dataset-progress" id="dataset-progress" style="display:none">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill" style="width:0%"></div>
          <div class="progress-text" id="progress-text">0%</div>
        </div>
        <div class="progress-message" id="progress-message">Loading...</div>
      </div>
      <div class="demo-datasets" id="demo-datasets" style="display:none"></div>
      <div id="extended-importer-form" style="display:none"></div>
      <button class="back-button" id="back-button" style="display:none">Back</button>
    </div>
  </div>
  <input type="file" id="file-input" accept=".pkl" style="display:none">

  <!-- Right panel -->
  <div class="panel-right">
    <!-- import-file removed: label import now uses the label importer modal -->
    <div class="progress-check-bar">
      <button id="check-progress-btn" class="labeling-indicator" data-status="">
        <span class="indicator-dot"></span>
        <span class="indicator-label">Progress</span>
        <span class="indicator-subtext" id="indicator-subtext"></span>
      </button>
    </div>
    <div class="vote-section">
      <h3 class="good">Good <span class="label-count" id="good-count">(0)</span></h3>
      <div id="good-list"></div>
    </div>
    <div class="vote-section">
      <h3 class="bad">Bad <span class="label-count" id="bad-count">(0)</span></h3>
      <div id="bad-list"></div>
    </div>
  </div>
</div>

<!-- Progress Modal -->
<div id="progress-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Labeling Progress Analysis</h2>
      <button class="modal-close" id="modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <div class="progress-summary">
        <div class="progress-stat">
          <div class="progress-stat-label">Total Labels</div>
          <div class="progress-stat-value" id="stat-total-labels">0</div>
        </div>
        <div class="progress-stat">
          <div class="progress-stat-label">Total Clips</div>
          <div class="progress-stat-value" id="stat-total-clips">0</div>
        </div>
      </div>
      <div class="progress-chart">
        <h3>Error Cost Over Time</h3>
        <p style="font-size: 0.8rem; color: #888; margin-bottom: 8px;">
          Lower is better. When the line levels out, you're probably not making progress.
        </p>
        <canvas id="error-cost-chart" width="700" height="250"></canvas>
      </div>
      <div class="progress-chart">
        <h3>Prediction Stability</h3>
        <p style="font-size: 0.8rem; color: #888; margin-bottom: 8px;">
          Shows how many unlabeled clips change prediction at each step. When this stabilizes near zero, you're probably not making progress.
        </p>
        <canvas id="stability-chart" width="700" height="250"></canvas>
      </div>
      <div class="progress-recommendation">
        <h3>Recommendation</h3>
        <p id="recommendation-text">Loading...</p>
      </div>
    </div>
  </div>
</div>

<!-- Favorite Detectors Management Modal -->
<div id="favorites-modal" class="modal">
  <div class="modal-content" style="max-width: 700px;">
    <div class="modal-header">
      <h2>Manage Favorite Detectors</h2>
      <button class="modal-close" id="favorites-modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <!-- Add Detector Section -->
      <div style="background: #14161e; border: 1px solid #2a2d3a; border-radius: 6px; padding: 16px; margin-bottom: 20px;">
        <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #666; margin-bottom: 10px;">Add Detector</div>
        <div style="margin-bottom: 10px;">
          <label style="font-size: 0.78rem; color: #888; display: block; margin-bottom: 4px;">Name (optional ‚Äî defaults to filename)</label>
          <input type="text" id="fav-add-name" placeholder="e.g. Dog Barks" style="width: 100%; padding: 6px 8px; border: 1px solid #2a2d3a; border-radius: 4px; background: #1a1d27; color: #e0e0e0; font-size: 0.85rem; outline: none;">
        </div>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          <button id="fav-add-from-votes-btn" style="flex: 1; padding: 8px 12px; background: #7c8aff; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">From Current Labels</button>
          <button id="fav-add-from-detector-btn" style="flex: 1; padding: 8px 12px; background: #3a3d50; color: #ccc; border: 1px solid #4a4d60; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">From Detector File (.json)</button>
          <button id="fav-add-from-labels-btn" style="flex: 1; padding: 8px 12px; background: #3a3d50; color: #ccc; border: 1px solid #4a4d60; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">From Label File (.json)</button>
        </div>
        <div id="fav-add-status" style="font-size: 0.78rem; color: #888; margin-top: 8px; min-height: 1.2em;"></div>
      </div>
      <!-- Saved Detectors List -->
      <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #666; margin-bottom: 8px;">Saved Detectors</div>
      <div id="favorites-list">
        <p style="color: #888;">No favorite detectors saved yet.</p>
      </div>
    </div>
  </div>
</div>
<!-- Hidden file inputs for favorites modal -->
<input type="file" id="fav-detector-file-input" accept=".json" style="display:none">
<input type="file" id="fav-labels-file-input" accept=".json" style="display:none">

<!-- Auto-Detect Results Modal -->
<div id="autodetect-modal" class="modal">
  <div class="modal-content" style="max-width: 1000px;">
    <div class="modal-header">
      <h2>Auto-Detect Results</h2>
      <button class="modal-close" id="autodetect-modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <div id="autodetect-summary" style="margin-bottom: 16px;"></div>
      <div id="autodetect-results" style="max-height: 500px; overflow-y: auto;"></div>
      <div style="margin-top: 16px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
        <label style="color: #aaa; font-size: 0.85rem;">Column:
          <select id="copy-column-select" style="padding: 4px 8px; background: #1a1d27; color: #e0e0e0; border: 1px solid #2a2d3a; border-radius: 4px; font-size: 0.85rem; margin-left: 4px;">
            <option value="origin+name">origin+name</option>
            <option value="name">name</option>
            <option value="md5">md5</option>
            <option value="filename">filename</option>
            <option value="origin">origin</option>
          </select>
        </label>
        <label style="color: #aaa; font-size: 0.85rem;">Separator:
          <select id="copy-separator-select" style="padding: 4px 8px; background: #1a1d27; color: #e0e0e0; border: 1px solid #2a2d3a; border-radius: 4px; font-size: 0.85rem; margin-left: 4px;">
            <option value="newline">newline</option>
            <option value=",">,</option>
            <option value="tab">tab</option>
            <option value="space">space</option>
          </select>
        </label>
        <button id="copy-results-btn" style="padding: 8px 16px; background: #7c8aff; color: #fff; border: none; border-radius: 4px; cursor: pointer;">Copy To Clipboard</button>
      </div>
    </div>
  </div>
</div>

<!-- Auto-Detect Progress Modal -->
<div id="autodetect-progress-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Running Auto-Detect</h2>
    </div>
    <div class="modal-body">
      <div id="autodetect-progress-text" style="margin-bottom: 16px; color: #e0e0e0;">Initializing...</div>
      <div style="background: #2a2d3a; border-radius: 8px; overflow: hidden; height: 24px;">
        <div id="autodetect-progress-bar" style="background: #7c8aff; height: 100%; width: 0%; transition: width 0.3s;"></div>
      </div>
    </div>
  </div>
</div>

<!-- Label Importer Picker Modal -->
<div id="label-importer-modal" class="modal">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <h2>Import Labels</h2>
      <button class="modal-close" id="label-importer-modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <div id="label-importer-list"></div>
      <div id="label-importer-form" style="display:none"></div>
      <button id="label-importer-back" style="display:none; margin-top:12px; padding:6px 14px; background:#3a3d50; color:#ccc; border:1px solid #4a4d60; border-radius:4px; cursor:pointer;">&#8592; Back</button>
    </div>
  </div>
</div>

<!-- Processor Importer Picker Modal -->
<div id="processor-importer-modal" class="modal">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <h2>Import Detector</h2>
      <button class="modal-close" id="processor-importer-modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <div id="processor-importer-list"></div>
      <div id="processor-importer-form" style="display:none"></div>
      <button id="processor-importer-back" style="display:none; margin-top:12px; padding:6px 14px; background:#3a3d50; color:#ccc; border:1px solid #4a4d60; border-radius:4px; cursor:pointer;">&#8592; Back</button>
    </div>
  </div>
</div>

<!-- Labeling Progress Analysis Loading Modal -->
<div id="labeling-analysis-modal" class="modal">
  <div class="modal-content" style="min-width: 360px;">
    <div class="modal-header">
      <h2>Analyzing Labeling Progress</h2>
    </div>
    <div class="modal-body">
      <div id="labeling-analysis-text" style="margin-bottom: 16px; color: #aaa; font-size: 0.9rem;">Training models over label history‚Ä¶</div>
      <div style="background: #2a2d3a; border-radius: 8px; overflow: hidden; height: 24px; position: relative;">
        <div id="labeling-analysis-bar" style="background: linear-gradient(90deg, #7c8aff, #a0aaff); height: 100%; width: 0%; transition: width 0.3s;"></div>
        <div id="labeling-analysis-pct" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 0.75rem; color: #fff; font-weight: bold;">0%</div>
      </div>
    </div>
  </div>
</div>

<script src="/static/app.js"></script>
</body>
</html>
